/*
    Doctor Management System

    UC-2.1: Add Doctor Profile
    UC-2.2: Assign / Update Doctor Specialty
    UC-2.3: View Doctors by Specialty
    UC-2.4: Deactivate Doctor Profile
*/

CREATE DATABASE hospital_mgmt_db;

USE hospital_mgmt_db;

CREATE TABLE specialties (
    specialty_id INT PRIMARY KEY AUTO_INCREMENT,
    specialty_name VARCHAR(100) UNIQUE NOT NULL
);

CREATE TABLE doctors (
    doctor_id INT PRIMARY KEY AUTO_INCREMENT,
    doctor_name VARCHAR(100) NOT NULL,
    contact VARCHAR(15),
    consultation_fee DECIMAL(10,2),
    specialty_id INT,
    is_active BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (specialty_id) REFERENCES specialties(specialty_id)
);

CREATE TABLE appointments (
    appointment_id INT PRIMARY KEY AUTO_INCREMENT,
    doctor_id INT,
    appointment_date DATE,
    FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id)
);

--------------------------------------------------
-- UC-2.1: Add Doctor Profile
--------------------------------------------------

INSERT INTO specialties (specialty_name)
VALUES ('Cardiology'), ('Orthopedics'), ('Dermatology');

INSERT INTO doctors (doctor_name, contact, consultation_fee, specialty_id)
VALUES ('Dr. Mehta', '9876543210', 800.00, 1);

SELECT * FROM specialties;

/*
+--------------+----------------+
| specialty_id | specialty_name |
+--------------+----------------+
|            1 | Cardiology     |
|            3 | Dermatology    |
|            2 | Orthopedics    |
+--------------+----------------+
*/

--------------------------------------------------
-- UC-2.2: Assign / Update Doctor Specialty
--------------------------------------------------

START TRANSACTION;

UPDATE doctors
SET specialty_id = 2
WHERE doctor_id = 1;

COMMIT;

--------------------------------------------------
-- UC-2.3: View Doctors by Specialty
--------------------------------------------------

SELECT
    d.doctor_id,
    d.doctor_name,
    s.specialty_name,
    d.contact,
    d.consultation_fee
FROM doctors d
JOIN specialties s ON d.specialty_id = s.specialty_id
WHERE s.specialty_name = 'Orthopedics'
AND d.is_active = TRUE;

/*
+-----------+-------------+----------------+------------+------------------+
| doctor_id | doctor_name | specialty_name | contact    | consultation_fee |
+-----------+-------------+----------------+------------+------------------+
|         1 | Dr. Mehta   | Orthopedics    | 9876543210 |           800.00 |
+-----------+-------------+----------------+------------+------------------+
*/

--------------------------------------------------
-- UC-2.4: Deactivate Doctor Profile
--------------------------------------------------

INSERT INTO appointments (doctor_id, appointment_date)
VALUES (1, DATE_ADD(CURDATE(), INTERVAL 5 DAY));

SELECT *
FROM appointments
WHERE doctor_id = 1
AND appointment_date > CURDATE();

/*
+----------------+-----------+------------------+
| appointment_id | doctor_id | appointment_date |
+----------------+-----------+------------------+
|              1 |         1 | 2026-02-13       |
+----------------+-----------+------------------+
*/

UPDATE doctors
SET is_active = FALSE
WHERE doctor_id = 1
AND doctor_id NOT IN (
    SELECT doctor_id
    FROM appointments
    WHERE appointment_date > CURDATE()
);

SELECT doctor_id, doctor_name, is_active FROM doctors;

/*
+-----------+-------------+-----------+
| doctor_id | doctor_name | is_active |
+-----------+-------------+-----------+
|         1 | Dr. Mehta   |         1 |
+-----------+-------------+-----------+
*/
