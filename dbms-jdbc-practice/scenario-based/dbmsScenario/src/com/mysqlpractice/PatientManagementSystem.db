/*
    Patient Management System

    UC-1.1: Register New Patient
    UC-1.2: Update Patient Information
    UC-1.3: Search Patient Records
    UC-1.4: View Patient Visit History
*/

CREATE DATABASE hospital_db;

USE hospital_db;

CREATE TABLE patients (
    patient_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    dob DATE,
    phone VARCHAR(15) UNIQUE,
    email VARCHAR(100) UNIQUE,
    address VARCHAR(255),
    blood_group VARCHAR(5)
);

CREATE TABLE doctors (
    doctor_id INT PRIMARY KEY AUTO_INCREMENT,
    doctor_name VARCHAR(100),
    specialization VARCHAR(100)
);

CREATE TABLE appointments (
    appointment_id INT PRIMARY KEY AUTO_INCREMENT,
    patient_id INT,
    doctor_id INT,
    appointment_date DATE,
    FOREIGN KEY (patient_id) REFERENCES patients(patient_id),
    FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id)
);

CREATE TABLE visits (
    visit_id INT PRIMARY KEY AUTO_INCREMENT,
    appointment_id INT,
    diagnosis VARCHAR(255),
    visit_date DATE,
    FOREIGN KEY (appointment_id) REFERENCES appointments(appointment_id)
);

--------------------------------------------------
-- UC-1.1: Register New Patient
--------------------------------------------------

INSERT INTO patients (name, dob, phone, email, address, blood_group)
VALUES (
    'Anita Sharma',
    '1998-05-14',
    '9876543210',
    'anita@gmail.com',
    'Delhi',
    'O+'
);

SELECT * FROM patients;

/*
+------------+--------------+------------+------------+-----------------+---------+-------------+
| patient_id | name         | dob        | phone      | email           | address | blood_group |
+------------+--------------+------------+------------+-----------------+---------+-------------+
|          1 | Anita Sharma | 1998-05-14 | 9876543210 | anita@gmail.com | Delhi   | O+          |
+------------+--------------+------------+------------+-----------------+---------+-------------+
*/

--------------------------------------------------
-- UC-1.2: Update Patient Information
--------------------------------------------------

UPDATE patients
SET address = 'New Delhi',
    blood_group = 'A+'
WHERE patient_id = 1;

SELECT * FROM patients WHERE patient_id = 1;

/*
+------------+--------------+------------+------------+-----------------+-----------+-------------+
| patient_id | name         | dob        | phone      | email           | address   | blood_group |
+------------+--------------+------------+------------+-----------------+-----------+-------------+
|          1 | Anita Sharma | 1998-05-14 | 9876543210 | anita@gmail.com | New Delhi | A+          |
+------------+--------------+------------+------------+-----------------+-----------+-------------+
*/

--------------------------------------------------
-- UC-1.3: Search Patient Records
--------------------------------------------------

SELECT * FROM patients
WHERE name LIKE '%Anita%';

/*
+------------+--------------+------------+------------+-----------------+-----------+-------------+
| patient_id | name         | dob        | phone      | email           | address   | blood_group |
+------------+--------------+------------+------------+-----------------+-----------+-------------+
|          1 | Anita Sharma | 1998-05-14 | 9876543210 | anita@gmail.com | New Delhi | A+          |
+------------+--------------+------------+------------+-----------------+-----------+-------------+
*/

--------------------------------------------------
-- UC-1.4: View Patient Visit History
--------------------------------------------------

INSERT INTO doctors (doctor_name, specialization)
VALUES ('Dr. Mehta', 'Cardiology');

INSERT INTO appointments (patient_id, doctor_id, appointment_date)
VALUES (1, 1, CURDATE());

INSERT INTO visits (appointment_id, diagnosis, visit_date)
VALUES (1, 'High Blood Pressure', CURDATE());

SELECT
    p.name AS patient_name,
    d.doctor_name,
    a.appointment_date,
    v.visit_date,
    v.diagnosis
FROM patients p
JOIN appointments a ON p.patient_id = a.patient_id
JOIN doctors d ON a.doctor_id = d.doctor_id
JOIN visits v ON a.appointment_id = v.appointment_id
WHERE p.patient_id = 1
ORDER BY v.visit_date;

/*
+--------------+-------------+------------------+------------+---------------------+
| patient_name | doctor_name | appointment_date | visit_date | diagnosis           |
+--------------+-------------+------------------+------------+---------------------+
| Anita Sharma | Dr. Mehta   | 2026-02-08       | 2026-02-08 | High Blood Pressure |
+--------------+-------------+------------------+------------+---------------------+
*/
